!function(){"use strict";function BrutusinForm(e,t,r){function n(e,t,r){e.appendChild(t)}function i(){var e=document.createElement("form");return e.className="brutusin-form",e.onsubmit=function(e){return!1},e}function a(e){if(!BrutusinForms.factories.schemaResolver)throw"SchemaResolver factory not registered";var t=new BrutusinForms.factories.schemaResolver;return e&&e.customSchemaResolver&&(t.resolveSchemas=e.customSchemaResolver),t}function o(e){var t={};for(var r in BrutusinForms.factories.typeComponents){if(!BrutusinForms.factories.typeComponents[r])throw"TypeComponent factory not registered for type '"+r+"'";t[r]=BrutusinForms.factories.typeComponents[r]}return t}function s(e,t,r){var n=function(i){if(i&&i.type&&"null"!==i.type){if(!c.hasOwnProperty(i.type))throw"Component factory not found for schemas of type '"+i.type+"'";var a=new c[i.type];a.init(e,t,m),u.removeListener(e,n),r(a)}};u.addListener(e,n)}this.schema=e,this.initialData=t;var u=a(r);u.init(this);var l,c=o(r),p=i(),m={schemaResolver:u,createTypeComponent:s,appendChild:n};s("$",t,function(e){l=e,n(p,e.getDOM())}),this.getData=function(){return l.getData()},this.getDOM=function(){return p}}function I18n(){this.translations={},this.setTranslations=function(e){if(!e)throw"A translation map is required";this.translations=e},this.getTranslation=function(e){return this.translations[e]?this.translations[e]:"{$"+e+"}"}}function SchemaResolver(){function e(e){return e}function t(e,t){for(var r in n)if(r.startsWith(e)&&!t.hasOwnProperty(r)){var a=i[r];if(a)for(var o=0;o<a.length;o++)a[o](null);delete n[r]}}function r(e,t,r){function n(e,t){if(e)if(t(e),e.hasOwnProperty("oneOf"))for(var r in e.oneOf)n(e.oneOf[r],t);else if(e.hasOwnProperty("$ref")){var i=c(e.$ref);n(i,t)}else if("object"===e.type){if(e.properties){e.hasOwnProperty("required")&&Array.isArray(e.required)&&(e.requiredProperties=e.required,delete e.required);for(var a in e.properties)n(e.properties[a],t)}if(e.patternProperties)for(var o in e.patternProperties){var s=e.patternProperties[o];(s.hasOwnProperty("type")||s.hasOwnProperty("$ref")||s.hasOwnProperty("oneOf"))&&n(e.patternProperties[o],t)}e.additionalProperties&&(e.additionalProperties.hasOwnProperty("type")||e.additionalProperties.hasOwnProperty("oneOf"))&&n(e.additionalProperties,t)}else"array"===e.type&&n(e.items,t)}function i(e){n(e,function(e){"object"===e.type&&e.properties&&e.hasOwnProperty("required")&&Array.isArray(e.required)&&(e.requiredProperties=e.required,delete e.required)})}function a(e){n(e,function(e){if("object"===e.type&&e.additionalProperties){e.hasOwnProperty("patternProperties")||(e.patternProperties={});var t=!1;for(var r in e.patternProperties)if(".*"===r){t=!0;break}t||(e.patternProperties[".*"]=e.additionalProperties,delete e.additionalProperties)}})}function o(e,t){var n=l(t);if(p[e]={id:e,schema:n,"static":!r},t){if(t.hasOwnProperty("oneOf")){n.oneOf=new Array,n.type="oneOf";for(var i in t.oneOf){var a=e+"."+i;n.oneOf[i]=a,o(a,t.oneOf[i])}}else if(t.hasOwnProperty("$ref")){var s=c(t.$ref);if(s){if(t.hasOwnProperty("title")||t.hasOwnProperty("description")){var u={};for(var d in s)u[d]=s[d];t.hasOwnProperty("title")&&(u.title=t.title),t.hasOwnProperty("description")&&(u.description=t.description),s=u}o(e,s)}}else if("object"===t.type){if(t.properties){n.properties={};for(var d in t.properties){var a=e+"."+d;n.properties[d]=a;var h=t.properties[d];t.requiredProperties&&(containsStr(t.requiredProperties,d)?h.required=!0:h.required=!1),o(a,h)}}if(t.patternProperties){n.patternProperties={};for(var f in t.patternProperties){var v=e+"[/"+f+"/]";n.patternProperties[f]=v;var y=t.patternProperties[f];y.hasOwnProperty("type")||y.hasOwnProperty("$ref")||y.hasOwnProperty("oneOf")?o(v,t.patternProperties[f]):o(v,SCHEMA_ANY)}}}else"array"===t.type&&(n.items=e+"[#]",o(n.items,t.items));if(t.hasOwnProperty("dependsOn")){null===t.dependsOn&&(t.dependsOn=["$"]);for(var g=new Array,i=0;i<t.dependsOn.length;i++)t.dependsOn[i]?t.dependsOn[i].startsWith("$")?g[i]=t.dependsOn[i]:e.endsWith("]")?g[i]=e+"."+t.dependsOn[i]:g[i]=e.substring(0,e.lastIndexOf("."))+"."+t.dependsOn[i]:g[i]="$";p[e].dependsOn=g;for(var i=0;i<g.length;i++){var O=m[g[i]];O||(O=new Array,m[g[i]]=O),O[O.length]=e}}}}function s(){function e(t,r,n){if(r.hasOwnProperty(n))throw"Schema dependency graph has cycles";if(r[n]=null,!t.hasOwnProperty(n)){t[n]=null;var i=m[n];if(i)for(var a=0;a<i.length;a++)e(t,r,i[a]);delete r[n]}}var t=new Object;for(var r in m)t.hasOwnProperty(r)||e(t,new Object,r)}function u(){for(var e in m){if(!p.hasOwnProperty(e))throw"Invalid schema id found in dependecies: "+e;p[e].dependedBy=m[e]}}function l(e){var t={};for(var r in e)"items"!==r&&"properties"!==r&&"additionalProperties"!==r&&("pattern"===r?t[r]=new RegExp(e[r]):t[r]=e[r]);return t}function c(e){var r=e.split("/"),n=t;for(var i in r)"0"!==i&&(n=n[r[i]]);return n}var p={},m={};return i(t),a(t),o(e,t),s(),u(),p}var n,i={};this.init=function(e){this.form=e,n=r("$",e.schema,!1)},this.notifyChanged=function(e){var t=n[e].dependedBy;t&&this.resolve(t)},this.resolve=function(e){this.resolveSchemas(e,this.form.getData(),function(a){if(!a)throw"Couldn't resolve schema item '"+o+"'";for(var o in a)if(e.includes(o)&&(!n.hasOwnProperty(o)||JSON.stringify(n[o].schema)!==JSON.stringify(a[o]))){var s=r(o,a[o],!0);t(o,s);for(var u in s){n[u]=s[u];var l=i[u];if(l)for(var c=0;c<l.length;c++)l[c](s[u].schema)}}})},this.addListener=function(t,r){return t=e(t),i.hasOwnProperty(t)?i[t].push(r):i[t]=[r],n.hasOwnProperty(t)&&!n[t].dependsOn?void r(n[t].schema):void 0},this.removeListener=function(t,r){if(t=e(t),i.hasOwnProperty(t))for(var n=i[t],a=0;a<n.length;a++)if(n[a]===r){n.splice(a,1);break}},this.resolveSchemas=function(e,t,r){}}function TypeComponent(){this.init=function(e,t,r){this._||(this._={},this._.dom=document.createElement("div"));var n=this;for(this._.children={},this._.schemaListeners=[],e&&(this.schemaId=e),t&&(this.initialData=t),r&&(this._.appendChild=r.appendChild,this._.createTypeComponent=r.createTypeComponent,this._.registerSchemaListener=function(e,t){n._.schemaListeners.push({schemaId:e,callback:t}),r.schemaResolver.addListener(e,t)},this._.unRegisterSchemaListener=function(e,t){for(var i,a=0;a<n._.schemaListeners.length;a++)if(i=n._.schemaListeners[a],i.schemaId===e&&i.callback===t){n._.schemaListeners.splice(a,1);break}r.schemaResolver.removeListener(e,t)},this._.notifyChanged=function(e){r.schemaResolver.notifyChanged(e)});this._.dom.firstChild;)this._.dom.removeChild(this._dom.firstChild);this._.registerSchemaListener(this.schemaId,function(e){n._.schema?(n.dispose(),n.init()):(n._.schema=e,e&&n.render(e))})},this.render=function(e){},this.getDOM=function(){return this._.dom},this.getData=function(){},this.validate=function(){},this.onchange=function(){},this.dispose=function(){for(var e=this._.schemaListeners.length-1;e>=0;e--){var t=this._.schemaListeners[e];this._.unRegisterSchemaListener(t.schemaId,t.callback)}for(var r in this._.children)this._.children[r].dispose()}}function ArrayComponent(){this.render=function(e){function t(t,i){var a=document.createElement("tbody"),o=document.createElement("tr");o.className="item";var s=document.createElement("td");s.className="item-index";var u=document.createElement("td");u.className="item-action";var l=document.createElement("td");l.className="item-value";var c=document.createElement("button");c.setAttribute("type","button"),c.className="remove",e.readOnly===!0&&(c.disabled=!0),r(c,document.createTextNode("x"));var p,m=function(){for(var e=0;e<t.rows.length;e++){var r=t.rows[e];r.cells[0].innerHTML=e+1,r.index=e}};n._.createTypeComponent(e.items,i,function(e){p=e,n._.children.push(e),r(l,e.getDOM())}),c.onclick=function(){p&&(p.dispose(),p=null,o.parentNode.removeChild(o),n._.children.splice(o.index,1)),m()},r(u,c);var d=document.createTextNode(t.rows.length+1);r(s,d),r(o,s),r(o,u),r(o,l),r(a,o),r(t,a)}this._.children=[];var r=this._.appendChild;if(e){var n=this;this._.registerSchemaListener(this.schemaId,function(i){var a=document.createElement("div"),o=document.createElement("table");o.className="array";var s=document.createElement("button");if(e.readOnly&&(s.disabled=!0),s.setAttribute("type","button"),s.onclick=function(){t(o)},i.description&&(s.title=i.description),r(s,document.createTextNode(BrutusinForms.i18n.getTranslation("addItem"))),r(a,o),r(a,s),n.initialData&&n.initialData instanceof Array)for(var u=0;u<n.initialData.length;u++)t(o,n.initialData[u]);r(n.getDOM(),a)})}},this.getData=function(){var e=[];for(var t in this._.children)e[t]=this._.children[t].getData();return e}}function ObjectComponent(){this.render=function(e){function t(e,t,r){var s=document.createElement("tr"),u=RegExp(t),l=function(c){for(;s.firstChild;)s.removeChild(s.firstChild);var p=null;if(p){var m=o._.children[p];m&&(m.dispose(),delete o._.children[p])}if(c&&c.type&&"null"!==c.type){var d,h=document.createElement("td");h.className="add-prop-name";var f=document.createElement("table"),v=document.createElement("tr"),y=document.createElement("td"),g=document.createElement("td"),O=document.createElement("td");O.className="prop-value";var b=document.createElement("input");b.type="text",b.placeholder="/"+t+"/",b.onchange=function(){if(p&&delete o._.children[p],b.value&&-1!==b.value.search(u)){for(var e=b.value,t=1;p!==e&&o._.children.hasOwnProperty(e);)e=b.value+"("+t+")",t++;p=e,b.value=p,o._.children[p]=d}};var w=document.createElement("button");w.setAttribute("type","button"),w.className="remove",n(w,document.createTextNode("x")),w.onclick=function(){p&&delete o._.children[p],d&&(d.dispose(),d=null,s.parentNode.removeChild(s)),o._.unRegisterSchemaListener(e,l)},n(y,b),n(g,w),n(v,y),n(v,g),n(f,v),n(h,f),n(s,h),n(s,O),n(a,s),n(i,a),o._.createTypeComponent(e,r,function(e){d=e,p&&(o._.children[p]=e),n(O,e.getDOM())})}};return o._.registerSchemaListener(e,l),s}function r(e,t,r){var i=document.createElement("tr");return o._.registerSchemaListener(e,function(s){for(;i.firstChild;)i.removeChild(i.firstChild);var u=o._.children[t];if(u&&(u.dispose(),delete o._.children[t]),s&&s.type&&"null"!==s.type){var l=document.createElement("td");l.className="prop-name";var c=document.createElement("td");c.className="prop-value",n(a,i),n(i,l),n(l,document.createTextNode(t)),n(i,c),o._.createTypeComponent(e,r,function(e){o._.children[t]=e,n(c,e.getDOM())})}}),i}var n=this._.appendChild;if(e){var i=document.createElement("table");i.className="object";var a=document.createElement("tbody");n(i,a);var o=this;if(e.hasOwnProperty("properties"))for(var s in e.properties){var u=r(o.schemaId+"."+s,s,this.initialData?this.initialData[s]:null);n(a,u)}if(e.patternProperties){var l=[],c=document.createElement("div");n(c,i);for(var p in e.patternProperties){var m=document.createElement("div");m.className="add-pattern-div";var d=document.createElement("button");if(d.setAttribute("type","button"),d.pattern=p,d.onclick=function(){var r=this.pattern,i=t(e.patternProperties[r],r);n(a,i)},1===Object.keys(e.patternProperties).length?n(d,document.createTextNode(BrutusinForms.i18n.getTranslation("addItem"))):n(d,document.createTextNode(BrutusinForms.i18n.getTranslation("addItem")+" /"+p+"/")),n(m,d,e),this.initialData)for(var s in initialData)if(!e.properties||!e.properties.hasOwnProperty(s)){var h=RegExp(p);if(-1!==s.search(h)&&-1===l.indexOf(s)){var u=t(e.patternProperties[p],p,this.initialData[s]);n(a,u),l.push(s)}}n(c,m)}n(this.getDOM(),c)}else n(this.getDOM(),i)}},this.getData=function(){var e={};for(var t in this._.children)e[t]=this._.children[t].getData();return e}}function SimpleComponent(){this.render=function(e){function t(){var t;if("any"===e.type)t=document.createElement("textarea"),i&&(t.value=JSON.stringify(i,null,4),e.readOnly&&(t.disabled=!0));else if(e.media)t=document.createElement("input"),t.type="file",n(t,r);else if(e["enum"]){if(t=document.createElement("select"),!e.required){var r=document.createElement("option"),a=document.createTextNode("");r.value="",n(r,a),n(t,r)}for(var o=0,s=0;s<e["enum"].length;s++){var r=document.createElement("option"),a=document.createTextNode(e["enum"][s]);r.value=e["enum"][s],n(r,a),n(t,r),i&&e["enum"][s]===i&&(o=s,e.required||o++,e.readOnly&&(t.disabled=!0))}1===e["enum"].length?t.selectedIndex=1:t.selectedIndex=o}else if("boolean"===e.type)if(e.required)t=document.createElement("input"),t.type="checkbox",i===!0&&(t.checked=!0);else{t=document.createElement("select");var u=document.createElement("option"),l=document.createTextNode("");l.value="",n(u,l),n(t,u);var c=document.createElement("option"),p=document.createTextNode(BrutusinForms.i18n.getTranslation("true"));c.value="true",n(c,p),n(t,c);var m=document.createElement("option"),d=document.createTextNode(BrutusinForms.i18n.getTranslation("false"));m.value="false",n(m,d),n(t,m),i===!0?t.selectedIndex=1:i===!1&&(t.selectedIndex=2)}else{if(t=document.createElement("input"),"integer"===e.type||"number"===e.type)t.type="number",t.step="any","number"!=typeof i&&(i=null);else if("date-time"===e.format)try{t.type="datetime-local"}catch(h){t.type="text"}else"email"===e.format?t.type="email":"text"===e.format?t=document.createElement("textarea"):t.type="text";null!==i&&"undefined"!=typeof i&&(t.value=i,e.readOnly&&(t.disabled=!0))}return e.description&&(t.title=e.description,t.placeholder=e.description),t.setAttribute("autocorrect","off"),t}var r=this,n=this._.appendChild,i=this.initialData;this._.input=t(),this._.input.onchange=function(e){r._.notifyChanged(r.schemaId),r.onchange(e)},n(this._.dom,this._.input)},this.getData=function(){function getValue(schema,input){if(!schema)return null;if("function"==typeof input.getValue)return input.getValue();var value;return value=schema["enum"]?input.options[input.selectedIndex].value:input.value,""===value?null:("integer"===schema.type?(value=parseInt(value),isFinite(value)||(value=null)):"number"===schema.type?(value=parseFloat(value),isFinite(value)||(value=null)):"boolean"===schema.type?"input"===input.tagName.toLowerCase()?(value=input.checked,value||(value=!1)):"select"===input.tagName.toLowerCase()&&(value="true"===input.value?!0:"false"===input.value?!1:null):"any"===schema.type&&value&&eval("value="+value),value)}return getValue(this._.schema,this._.input)}}if(String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();(void 0===t||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return-1!==n&&n===t}),String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)}),String.prototype.format||(String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var r=new RegExp("\\{"+t+"\\}","gi");e=e.replace(r,arguments[t])}return e}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){function r(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return!1;for(var a=0|t,o=Math.max(a>=0?a:i-Math.abs(a),0);i>o;){if(r(n[o],e))return!0;o++}return!1}}),"undefined"==typeof brutusin)window.brutusin=new Object;else if("object"!=typeof brutusin)throw"brutusin global variable already exists";var BrutusinForms=new Object;BrutusinForms.factories={schemaResolver:null,typeComponents:{string:null,object:null,array:null,"boolean":null,number:null,integer:null,any:null}},brutusin["json-forms"]=BrutusinForms,BrutusinForms.createForm=function(e,t,r){return new BrutusinForm(e,t,r)},BrutusinForms.i18n=new I18n;var SCHEMA_ANY={type:"any"};if(BrutusinForms.factories.schemaResolver=SchemaResolver,BrutusinForms.TypeComponent=TypeComponent,ArrayComponent.prototype=new BrutusinForms.TypeComponent,BrutusinForms.factories.typeComponents.array=ArrayComponent,ObjectComponent.prototype=new BrutusinForms.TypeComponent,BrutusinForms.factories.typeComponents.object=ObjectComponent,SimpleComponent.prototype=new BrutusinForms.TypeComponent,BrutusinForms.factories.typeComponents.string=SimpleComponent,BrutusinForms.factories.typeComponents["boolean"]=SimpleComponent,BrutusinForms.factories.typeComponents.integer=SimpleComponent,BrutusinForms.factories.typeComponents.number=SimpleComponent,BrutusinForms.factories.typeComponents.any=SimpleComponent,"undefined"==typeof brutusin||"undefined"==typeof brutusin["json-forms"])throw new Error("brutusin-json-forms.js is required");!function(){var e=brutusin["json-forms"];e.i18n.setTranslations({validationError:"Validation error",required:"This field is **required**",invalidValue:"Invalid field value",addpropNameExistent:"This property is already present in the object",addpropNameRequired:"A name is required",minItems:"At least `{0}` items are required",maxItems:"At most `{0}` items are allowed",pattern:"Value does not match pattern: `{0}`",minLength:"Value must be **at least** `{0}` characters long",maxLength:"Value must be **at most** `{0}` characters long",multipleOf:"Value must be **multiple of** `{0}`",minimum:"Value must be **greater or equal than** `{0}`",exclusiveMinimum:"Value must be **greater than** `{0}`",maximum:"Value must be **lower or equal than** `{0}`",exclusiveMaximum:"Value must be **lower than** `{0}`",minProperties:"At least `{0}` properties are required",maxProperties:"At most `{0}` properties are allowed",uniqueItems:"Array items must be unique",addItem:"Add item","true":"True","false":"False"})}()}();