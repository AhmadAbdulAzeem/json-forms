!function(){"use strict";function BrutusinForm(e,t,n){function r(e,t,n){e.appendChild(t)}function i(){var e=document.createElement("form");return e.className="brutusin-form",e.onsubmit=function(e){return!1},e}function o(e){if(!BrutusinForms.factories.schemaResolver)throw"SchemaResolver factory not registered";var t=new BrutusinForms.factories.schemaResolver;return e&&e.customSchemaResolver&&(t.resolveSchemas=e.customSchemaResolver),t}function s(e){var t={};for(var n in BrutusinForms.factories.typeComponents){if(!BrutusinForms.factories.typeComponents[n])throw"TypeComponent factory not registered for type '"+n+"'";t[n]=BrutusinForms.factories.typeComponents[n]}return t}function a(e,t,n){var r=function(i){if(i&&i.type&&"null"!==i.type){if(!l.hasOwnProperty(i.type))throw"Component factory not found for schemas of type '"+i.type+"'";var o=new l[i.type];o.init(e,t,f),u.removeListener(e,r),n(o)}};u.addListener(e,r)}this.schema=e,this.initialData=t;var u=o(n);u.init(this);var p,l=s(n),c=i(),f={schemaResolver:u,createTypeComponent:a,appendChild:r};a("$",t,function(e){p=e,r(c,e.getDOM())}),this.getData=function(){return p.getData()},this.getDOM=function(){return c}}function SchemaResolver(){function e(e){return e.replace(/\["[^"]*"\]/g,"[*]").replace(/\[\d*\]/g,"[#]")}function t(e,t){for(var n in r)if(n.startsWith(e)&&!t.hasOwnProperty(n)){var o=i[n];if(o)for(var s=0;s<o.length;s++)o[s](null);delete r[n]}}function n(e,t,n){function r(e){if(e)if(e.hasOwnProperty("oneOf"))for(var t in e.oneOf)r(e.oneOf[t]);else if(e.hasOwnProperty("$ref")){var n=u(e.$ref);r(n)}else if("object"===e.type){if(e.properties){e.hasOwnProperty("required")&&Array.isArray(e.required)&&(e.requiredProperties=e.required,delete e.required);for(var i in e.properties)r(e.properties[i])}if(e.patternProperties)for(var o in e.patternProperties){var s=e.patternProperties[o];(s.hasOwnProperty("type")||s.hasOwnProperty("$ref")||s.hasOwnProperty("oneOf"))&&r(e.patternProperties[o])}e.additionalProperties&&(e.additionalProperties.hasOwnProperty("type")||e.additionalProperties.hasOwnProperty("oneOf"))&&r(e.additionalProperties)}else"array"===e.type&&r(e.items)}function i(e,t){var r=a(t);if(p[e]={id:e,schema:r,"static":!n},t){if(t.hasOwnProperty("oneOf")){r.oneOf=new Array,r.type="oneOf";for(var o in t.oneOf){var s=e+"."+o;r.oneOf[o]=s,i(s,t.oneOf[o])}}else if(t.hasOwnProperty("$ref")){var c=u(t.$ref);if(c){if(t.hasOwnProperty("title")||t.hasOwnProperty("description")){var f={};for(var m in c)f[m]=c[m];t.hasOwnProperty("title")&&(f.title=t.title),t.hasOwnProperty("description")&&(f.description=t.description),c=f}i(e,c)}}else if("object"===t.type){if(t.properties){r.properties={};for(var m in t.properties){var s=e+"."+m;r.properties[m]=s;var d=t.properties[m];t.requiredProperties&&(containsStr(t.requiredProperties,m)?d.required=!0:d.required=!1),i(s,d)}}if(t.patternProperties){r.patternProperties={};for(var h in t.patternProperties){var v=e+"["+h+"]";r.patternProperties[h]=v;var y=t.patternProperties[h];y.hasOwnProperty("type")||y.hasOwnProperty("$ref")||y.hasOwnProperty("oneOf")?i(v,t.patternProperties[h]):i(v,SCHEMA_ANY)}}if(t.additionalProperties){var s=e+"[*]";r.additionalProperties=s,t.additionalProperties.hasOwnProperty("type")||t.additionalProperties.hasOwnProperty("oneOf")?i(s,t.additionalProperties):i(s,SCHEMA_ANY)}}else"array"===t.type&&(r.items=e+"[#]",i(r.items,t.items));if(t.hasOwnProperty("dependsOn")){null===t.dependsOn&&(t.dependsOn=["$"]);for(var O=new Array,o=0;o<t.dependsOn.length;o++)t.dependsOn[o]?t.dependsOn[o].startsWith("$")?O[o]=t.dependsOn[o]:e.endsWith("]")?O[o]=e+"."+t.dependsOn[o]:O[o]=e.substring(0,e.lastIndexOf("."))+"."+t.dependsOn[o]:O[o]="$";p[e].dependsOn=O;for(var o=0;o<O.length;o++){var g=l[O[o]];g||(g=new Array,l[O[o]]=g),g[g.length]=e}}}}function o(){function e(t,n,r){if(n.hasOwnProperty(r))throw"Schema dependency graph has cycles";if(n[r]=null,!t.hasOwnProperty(r)){t[r]=null;var i=l[r];if(i)for(var o=0;o<i.length;o++)e(t,n,i[o]);delete n[r]}}var t=new Object;for(var n in l)t.hasOwnProperty(n)||e(t,new Object,n)}function s(){for(var e in l){if(!p.hasOwnProperty(e))throw"Invalid schema id found in dependecies: "+e;p[e].dependedBy=l[e]}}function a(e){var t={};for(var n in e)"items"!==n&&"properties"!==n&&"additionalProperties"!==n&&("pattern"===n?t[n]=new RegExp(e[n]):t[n]=e[n]);return t}function u(e){var n=e.split("/"),r=t;for(var i in n)"0"!==i&&(r=r[n[i]]);return r}var p={},l={};return r(t),i(e,t),o(),s(),p}var r,i={};this.init=function(e){this.form=e,r=n("$",e.schema,!1)},this.notifyChanged=function(e){var t=r[e].dependedBy;t&&this.resolve(t)},this.resolve=function(e){this.resolveSchemas(e,this.form.getData(),function(o){if(!o)throw"Couldn't resolve schema item '"+s+"'";for(var s in o)if(e.includes(s)&&(!r.hasOwnProperty(s)||JSON.stringify(r[s].schema)!==JSON.stringify(o[s]))){var a=n(s,o[s],!0);t(s,a);for(var u in a){r[u]=a[u];var p=i[u];if(p)for(var l=0;l<p.length;l++)p[l](a[u].schema)}}})},this.addListener=function(t,n){return t=e(t),i.hasOwnProperty(t)?i[t].push(n):i[t]=[n],r.hasOwnProperty(t)&&!r[t].dependsOn?void n(r[t].schema):void 0},this.removeListener=function(t,n){if(t=e(t),i.hasOwnProperty(t))for(var r=i[t],o=0;o<r.length;o++)if(r[o]===n){r.splice(o,1);break}},this.resolveSchemas=function(e,t,n){}}function TypeComponent(){this.componentFunctions={removeAllChildren:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}},this.init=function(e,t,n){function r(){i.componentFunctions.removeAllChildren(i.dom),i.children={}}this.schemaId=e,this.initialData=t,this.formFunctions=n,this.dom=document.createElement("div");var i=this;this.schemaListener=function(e){i.schema=e,r(),e&&i.render(e)},this.formFunctions.schemaResolver.addListener(this.schemaId,this.schemaListener)},this.render=function(e){},this.getDOM=function(){return this.dom},this.getData=function(){},this.validate=function(){},this.onchange=function(){},this.dispose=function(){this.formFunctions.schemaResolver.removeListener(this.schemaId,this.schemaListener)}}function ObjectComponent(){this.render=function(e){var t=this.formFunctions.appendChild;if(this.componentFunctions.removeAllChildren(this.dom),e){var n=document.createElement("table");n.className="object";var r=document.createElement("tbody");t(n,r);var i=this;if(e.hasOwnProperty("properties"))for(var o in e.properties){var s=o,a=this.schemaId+"."+s,u=document.createElement("tr");this.formFunctions.schemaResolver.addListener(a,function(e){i.componentFunctions.removeAllChildren(u);var n=i.children[s];if(n&&(n.dispose(),delete i.children[s]),e&&e.type&&"null"!==e.type){var o=document.createElement("td");o.className="prop-name";var p=document.createElement("td");p.className="prop-value",t(r,u),t(u,o),t(o,document.createTextNode(s)),t(u,p),i.formFunctions.createTypeComponent(a,null,function(e){i.children[s]=e,t(p,e.getDOM())})}})}t(this.dom,n)}},this.getData=function(){var e={};for(var t in this.children)e[t]=this.children[t].getData();return e}}function SimpleComponent(){this.render=function(e){function t(){var t;if("any"===e.type)t=document.createElement("textarea"),i&&(t.value=JSON.stringify(i,null,4),e.readOnly&&(t.disabled=!0));else if(e.media)t=document.createElement("input"),t.type="file",r(t,n);else if(e["enum"]){if(t=document.createElement("select"),!e.required){var n=document.createElement("option"),o=document.createTextNode("");n.value="",r(n,o),r(t,n)}for(var s=0,a=0;a<e["enum"].length;a++){var n=document.createElement("option"),o=document.createTextNode(e["enum"][a]);n.value=e["enum"][a],r(n,o),r(t,n),i&&e["enum"][a]===i&&(s=a,e.required||s++,e.readOnly&&(t.disabled=!0))}1===e["enum"].length?t.selectedIndex=1:t.selectedIndex=s}else{if(t=document.createElement("input"),"integer"===e.type||"number"===e.type)t.type="number",t.step="any","number"!=typeof i&&(i=null);else if("date-time"===e.format)try{t.type="datetime-local"}catch(u){t.type="text"}else"email"===e.format?t.type="email":"text"===e.format?t=document.createElement("textarea"):t.type="text";null!==i&&"undefined"!=typeof i&&(t.value=i,e.readOnly&&(t.disabled=!0))}return e.description&&(t.title=e.description,t.placeholder=e.description),t.setAttribute("autocorrect","off"),t}var n=this,r=this.formFunctions.appendChild,i=this.initialData;this.input=t(),this.input.onchange=function(e){n.formFunctions.schemaResolver.notifyChanged(n.schemaId),n.onchange(e)},this.componentFunctions.removeAllChildren(this.dom),r(this.dom,this.input)},this.getData=function(){function getValue(schema,input){if(!schema)return null;if("function"==typeof input.getValue)return input.getValue();var value;return value=schema["enum"]?input.options[input.selectedIndex].value:input.value,""===value?null:("integer"===schema.type?(value=parseInt(value),isFinite(value)||(value=null)):"number"===schema.type?(value=parseFloat(value),isFinite(value)||(value=null)):"boolean"===schema.type?"input"===input.tagName.toLowerCase()?(value=input.checked,value||(value=!1)):"select"===input.tagName.toLowerCase()&&(value="true"===input.value?!0:"false"===input.value?!1:null):"any"===schema.type&&value&&eval("value="+value),value)}return getValue(this.schema,this.input)}}if(String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();(void 0===t||t>n.length)&&(t=n.length),t-=e.length;var r=n.indexOf(e,t);return-1!==r&&r===t}),String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)}),String.prototype.format||(String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){function n(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),i=r.length>>>0;if(0===i)return!1;for(var o=0|t,s=Math.max(o>=0?o:i-Math.abs(o),0);i>s;){if(n(r[s],e))return!0;s++}return!1}}),"undefined"==typeof brutusin)window.brutusin=new Object;else if("object"!=typeof brutusin)throw"brutusin global variable already exists";var BrutusinForms=new Object;BrutusinForms.factories={schemaResolver:null,typeComponents:{string:null,object:null,"boolean":null,number:null,integer:null,any:null}},brutusin["json-forms"]=BrutusinForms,BrutusinForms.createForm=function(e,t,n){return new BrutusinForm(e,t,n)};var SCHEMA_ANY={type:"any"};BrutusinForms.factories.schemaResolver=SchemaResolver,BrutusinForms.TypeComponent=TypeComponent,ObjectComponent.prototype=new BrutusinForms.TypeComponent,BrutusinForms.factories.typeComponents.object=ObjectComponent,SimpleComponent.prototype=new BrutusinForms.TypeComponent,BrutusinForms.factories.typeComponents.string=SimpleComponent,BrutusinForms.factories.typeComponents["boolean"]=SimpleComponent,BrutusinForms.factories.typeComponents.integer=SimpleComponent,BrutusinForms.factories.typeComponents.number=SimpleComponent,BrutusinForms.factories.typeComponents.any=SimpleComponent}();